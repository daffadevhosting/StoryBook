---
layout: default
title: Akun Saya
permalink: /akun_saya
---

<section class="max-w-2xl mx-auto px-4 py-12">
  <div class="bg-white rounded-xl shadow p-6">
    <div class="flex justify-between items-center mb-6">
      <div class="flex items-center gap-4">
        <img id="userPhoto" src="/assets/img/default-avatar.png"
             class="w-16 h-16 rounded-full border shadow" alt="Avatar">
        <div>
          <h2 id="userName" class="text-lg font-bold text-gray-800">Nama Pengguna</h2>
          <p id="userEmail" class="text-sm text-gray-500">email@example.com</p>
        </div>
      </div>
      <button id="logoutBtn"
              class="text-sm bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition">
        🔓 Logout
      </button>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
      <div class="bg-purple-50 rounded-lg p-4">
        <p class="text-xs text-gray-500">Tier Anda:</p>
        <h3 id="userTier" class="text-xl font-bold text-purple-700">Gratisan</h3>
      </div>
      <div class="bg-blue-50 rounded-lg p-4">
        <p class="text-xs text-gray-500">Berlaku hingga:</p>
        <h3 id="premiumUntil" class="text-xl font-bold text-blue-700">-</h3>
      </div>
      <div class="bg-yellow-50 rounded-lg p-4 col-span-2">
        <p class="text-xs text-gray-500">Cerita hari ini:</p>
        <h3 id="storyCount" class="text-xl font-bold text-yellow-800">0 / 5</h3>
        <p class="text-xs text-gray-400 mt-1">Akan direset setiap jam 00:00</p>
      </div>
    </div>

    <a href="{{site.baseurl}}/harga"
       class="block w-full text-center bg-purple-600 text-white font-semibold py-2 rounded-lg mb-8 transition hover:bg-purple-700">
      💖 Perpanjang / Upgrade Paket
    </a>

    <!-- Riwayat Cerita -->
    <div>
      <h4 class="text-md font-semibold text-gray-800 mb-3">📚 Riwayat Cerita</h4>
      <ul id="storyList" class="space-y-3 text-sm text-gray-700">
        <li class="text-gray-400">Belum ada cerita tersimpan.</li>
      </ul>
    </div>
  </div>
</section>
<script type="module">
  import { auth, db } from './assets/js/firebase-config.js';
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  auth.onAuthStateChanged(async (user) => {
    if (!user) return location.href = './';

    const { displayName, email, photoURL, uid } = user;
    document.getElementById("userName").textContent = displayName;
    document.getElementById("userEmail").textContent = email;
    document.getElementById("userPhoto").src = photoURL;

    const userRef = doc(db, "users", uid);
    const userSnap = await getDoc(userRef);

    if (userSnap.exists()) {
      const data = userSnap.data();
      const tier = data.tier || (data.isPremium ? "Premium" : "Gratisan");
      const until = data.premiumUntil ? new Date(data.premiumUntil).toLocaleDateString() : "-";
      const count = data.storyCountToday ?? 0;
      const limit = tier === "Premium" || tier === "keluarga" ? "∞" : 5;

      document.getElementById("userTier").textContent = tier.charAt(0).toUpperCase() + tier.slice(1);
      document.getElementById("premiumUntil").textContent = until;
      document.getElementById("storyCount").textContent = `${count} / ${limit}`;
    }

    // Load saved stories from localStorage
    const storyList = document.getElementById("storyList");
    const saved = JSON.parse(localStorage.getItem("lyra_saved_stories") || "[]");

    if (saved.length > 0) {
      storyList.innerHTML = "";
      saved.forEach(item => {
        const li = document.createElement("li");
        li.className = "border p-3 rounded hover:bg-gray-50 cursor-pointer";
        li.textContent = item.title || "Cerita Tanpa Judul";
        li.onclick = () => {
          localStorage.setItem("lyra_last_session", item.content);
          location.href = "./buat-cerita";
        };
        storyList.appendChild(li);
      });
    }
  });

  // 🔓 Logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    auth.signOut().then(() => location.href = "./");
  });
</script>
